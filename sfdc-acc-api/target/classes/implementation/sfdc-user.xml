<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" 
	xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:salesforce="http://www.mulesoft.org/schema/mule/salesforce"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/salesforce http://www.mulesoft.org/schema/mule/salesforce/current/mule-salesforce.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
	
	<sub-flow name="sfdc-user-subflow" doc:id="940ba5c9-c42e-4bfa-aed4-a7fa4e0ed4e8" >
		<until-successful maxRetries="3" doc:name="retry" doc:id="35a380d5-65e8-4cfd-9deb-1858de723677" >
			<try doc:name="Try" doc:id="c7cee7bc-c34f-4cca-a874-17123d38c362" >
				<salesforce:query doc:name="user" doc:id="234b5ed0-70ae-439a-8e69-236941cc504d" config-ref="Salesforce_Config">
			<salesforce:salesforce-query><![CDATA[SELECT Email,Id,Name,Phone,Username FROM user where username = :'userName']]></salesforce:salesforce-query>
			<salesforce:parameters><![CDATA[#[output application/java
---
{
	"userName" : vars.uname
}]]]></salesforce:parameters>
		</salesforce:query>
				<logger level="INFO" doc:name="Logger" doc:id="fde265e8-8f82-410a-9f7c-045c03bfb548" message="#[%dw 2.0&#10;output application/json&#10;---&#10;payload]" category="sfdcuserresponse"/>
				<ee:transform doc:name="Transform Message" doc:id="244d4a00-9033-4730-9e19-008b8b0c7d06">
			<ee:message>
				<ee:set-payload><![CDATA[%dw 2.0
output application/json
---
payload]]></ee:set-payload>
			</ee:message>
		</ee:transform>
				<error-handler >
					<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="247ab208-597a-4b6e-a049-7ec4c1416616" type="SALESFORCE:CONNECTIVITY, SALESFORCE:TIMEOUT">
						<logger level="INFO" doc:name="Logger" doc:id="76db5566-8707-4ed4-8dc5-a65af07340e4" message="#[error]"/>
					</on-error-propagate>
					<on-error-continue enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="7f959698-93be-4fa6-b815-7e82788bb304" >
						<logger level="INFO" doc:name="Logger" doc:id="3d66c905-c09a-43bf-b624-e1b6c4b077f7" message="#[error]"/>
					</on-error-continue>
				</error-handler>
			</try>
		</until-successful>
	</sub-flow>
</mule>
